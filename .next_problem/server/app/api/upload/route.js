"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},33408:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>I,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var i=t(49303),o=t(88716),a=t(60670),u=t(87070),p=t(49788),n=t(65655);async function l(e){try{let r=(0,n.fU)(),{data:{user:t},error:s}=await r.auth.getUser();if(s||!t)return u.NextResponse.json({error:"Unauthorized"},{status:401});let i=await e.formData(),o=i.get("file"),a=i.get("productId"),l=parseInt(i.get("displayOrder"))||0;if(!o)return u.NextResponse.json({error:"No file provided"},{status:400});if(!o.type.startsWith("image/"))return u.NextResponse.json({error:"File must be an image"},{status:400});if(o.size>5242880)return u.NextResponse.json({error:"File size must be less than 5MB"},{status:400});let c=await o.arrayBuffer(),d=Buffer.from(c),m=await new Promise((e,r)=>{p.v2.uploader.upload_stream({resource_type:"image",folder:`easybuilder/products/${a}`,transformation:[{width:800,height:800,crop:"limit",quality:"auto"},{fetch_format:"auto"}],allowed_formats:["jpg","png","webp","avif"]},(t,s)=>{t?r(t):e(s)}).end(d)}),h={product_id:a,url:m.secure_url,alt_text:o.name.replace(/\.[^/.]+$/,""),display_order:l,file_size:o.size,mime_type:o.type,cloudinary_public_id:m.public_id},{data:I,error:x}=await r.from("product_images").insert(h).select().single();if(x)throw await p.v2.uploader.destroy(m.public_id),x;return u.NextResponse.json({success:!0,image:I,cloudinary:{public_id:m.public_id,url:m.secure_url,width:m.width,height:m.height}})}catch(e){return console.error("Image upload error:",e),u.NextResponse.json({error:"Failed to upload image"},{status:500})}}p.v2.config({cloud_name:"dhi7ojdum",api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/ayodelebabafemi/Projects/easybuilder/src/app/api/upload/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=c,I="/api/upload/route";function x(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},65655:(e,r,t)=>{t.d(r,{fU:()=>a,h:()=>p,yJ:()=>u});var s=t(67721),i=t(43974),o=t(71615);let a=()=>{let e=(0,o.cookies)();return(0,s.createServerClient)("https://ypukukqmhdittcmzollb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwdWt1a3FtaGRpdHRjbXpvbGxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1OTE2MjMsImV4cCI6MjA3NzE2NzYyM30.B-RhZ1eo_cECaFV0GoUzwnKRszKmXHX-5n7CvXbgjXA",{cookies:{get:r=>e.get(r)?.value,set(r,t,s){e.set({name:r,value:t,...s})},remove(r,t){e.set({name:r,value:"",...t})}}})},u=()=>(0,i.eI)("https://ypukukqmhdittcmzollb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlwdWt1a3FtaGRpdHRjbXpvbGxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1OTE2MjMsImV4cCI6MjA3NzE2NzYyM30.B-RhZ1eo_cECaFV0GoUzwnKRszKmXHX-5n7CvXbgjXA"),p=()=>{if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY is required for service operations");return(0,i.eI)("https://ypukukqmhdittcmzollb.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,355,972,788],()=>t(33408));module.exports=s})();